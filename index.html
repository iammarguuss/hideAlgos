<!DOCTYPE html>
<html lang="en" style="background:#212121">
<head>
    <meta charset="UTF-8">
    <title>Steroid Crypto Demo</title>
    <script src="main.js"></script>
</head>
<body>
    <h1>Steroid Crypto Demo</h1>
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            // Создаем экземпляр класса SteroidCrypto
            const crypto = new SteroidCrypto();
            console.log(crypto)
    
            // getSkey
            const hash = await crypto.getSkey('Hello, World!');
            console.log('getSkey: ', hash);
    
            //messageEnc
            const message = "Hello, World!";
            const password = "секретныйКлюч";
    
            const encryptedResult = await crypto.messageEnc(message, password, true);
            console.log("Encrypted result:", encryptedResult);
    
            // Расшифровка сообщения, если шифрование было успешным
            if (encryptedResult.s === 1) {
                const decryptedResult = await crypto.messageEnc(encryptedResult.t, password, false);
                console.log("Decrypted result:", decryptedResult);
            }
    
            //getPass
            crypto.getPass(password)
                .then(hash => console.log("Хэш пароля:", hash))
                .catch(error => console.error("Ошибка:", error));
    


           // Генерация пары ключей RSA
           const keyPairResult = await crypto.genPair(); // Можно указать другую битность, например genPair(2048)
            console.log("Key Pair Generation Result:", keyPairResult);
    
            // server emulation
            const hexString = 'abcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890'; // Пример hex строки
            const hexStringSHA = '9fac355710bb2183bf0cdf2c15c151b1c81d923a5586e7aab065b5fb6ebf889f'; // Пример hex строки


            // get the package ready
            // Использование публичного ключа и hex строки для CreatePackage
            const publicKeyBase64 = keyPairResult.r.publicKey;
            const packageResult = await crypto.createPackage(publicKeyBase64, hexStringSHA);
            console.log("Create Package Result:", packageResult);

            //validation if everything works fine            
            const validationResult = await crypto.prevalidator(packageResult.r, hexString);
            console.log("Validation Result:", validationResult);


            // Запуск метода responceRSA
            const responseResult = await crypto.responceRSA(validationResult.r, hexString);
            console.log("Response RSA Result:", responseResult);

            //password generated by change
            const ChangePassword = {
                pass: "Super super pass",
                chatID: 123
            }

            const encryptionResult = await crypto.encryptData(responseResult.r, hexString, hexStringSHA, keyPairResult.r.privateKey, keyPairResult.r.publicKey, ChangePassword, packageResult.salt);
            console.log("Encryption Result:", encryptionResult);

            // Запуск метода finalAccepter
            const result = await crypto.finalAccepter(encryptionResult.r, packageResult.r.signature, keyPairResult.r.publicKey, hexStringSHA, responseResult.aes);
            console.log("Final Accepter Result:", result);

            const checkResult = await crypto.lastCheck(result.r.signature, packageResult.salt);
            console.log("Last Check Result:", checkResult);


            //test password
            const passwordInfo = await crypto.ChangePassGen(32, true, true, true);
            console.log(passwordInfo);


        });
    </script>
    
</body>
</html>
